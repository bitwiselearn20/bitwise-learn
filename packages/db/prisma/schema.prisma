generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum COURSE_STATUS {
  PUBLISHED
  NOT_PUBLISHED
}

enum LISTING_STATUS {
  LISTED
  NOT_LISTED
}

enum PROCTOR {
  CHEATED
  NOT_CHEATED
}

enum COURSE_LEVEL {
  BASIC
  INTERMEDIATE
  ADVANCE
}

enum PROBLEM_LEVEL {
  EASY
  MEDIUM
  HARD
}

enum ASSIGNMENT_TYPE {
  MCQ
  SCQ
}

enum PROBLEM_STATUS {
  SUCCESS
  FAILED
}

enum TESTCASE_TYPE {
  EXAMPLE
  HIDDEN
}

enum ASSESSMENT_TYPE {
  CODE
  NO_CODE
}

enum ASSESSMENT_STATUS {
  UPCOMING
  LIVE
  ENDED
}

enum LANGUAGES {
  JS
  JAVA
  PYTHON
  C
  CPP
}

model User {
  id                     String                  @id @default(auto()) @map("_id") @db.ObjectId
  name                   String
  email                  String
  password               String
  ROLE                   String                  @default("SUPERADMIN")
  institutions           Institution[]
  courseSections         CourseSections[]
  courseLearningContents CourseLearningContent[]
  courses                Course[]
  problems               Problem[]
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt
}

model Institution {
  id                   String             @id @default(auto()) @map("_id") @db.ObjectId
  name                 String
  address              String
  pinCode              String
  tagline              String
  websiteLink          String
  loginPassword        String
  email                String             @unique
  secondaryEmail       String?
  phoneNumber          String             @unique
  secondaryPhoneNumber String?
  createdBy            String             @db.ObjectId
  creator              User               @relation(references: [id], fields: [createdBy])
  createdByVendorId    String?            @db.ObjectId
  createdByVendor      Vendor?            @relation("VendorCreatedInstitutions", fields: [createdByVendorId], references: [id])
  batches              Batch[]
  teachers             Teacher[]
  students             Student[]
  courseEnrollments    CourseEnrollment[]
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
}

model Vendor {
  id                   String        @id @default(auto()) @map("_id") @db.ObjectId
  name                 String
  email                String
  secondaryEmail       String?
  tagline              String
  phoneNumber          String
  secondaryPhoneNumber String?
  createdInstitutions  Institution[] @relation("VendorCreatedInstitutions")
  websiteLink          String
  loginPassword        String
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
}

model Batch {
  id                String             @id @default(auto()) @map("_id") @db.ObjectId
  batchname         String
  branch            String
  batchEndYear      String
  institutionId     String             @db.ObjectId
  institution       Institution        @relation(references: [id], fields: [institutionId])
  teachers          Teacher[]
  students          Student[]
  assessments       Assessment[]
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  courseEnrollments CourseEnrollment[]
}

model Teacher {
  id            String       @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  email         String
  phoneNumber   String
  loginPassword String
  vendorId      String?
  instituteId   String       @db.ObjectId
  institution   Institution  @relation(references: [id], fields: [instituteId])
  batchId       String       @db.ObjectId
  batch         Batch        @relation(references: [id], fields: [batchId])
  assessments   Assessment[]
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
}

model Student {
  id                          String                       @id @default(auto()) @map("_id") @db.ObjectId
  name                        String
  rollNumber                  String
  email                       String                       @unique
  loginPassword               String
  batchId                     String                       @db.ObjectId
  batch                       Batch                        @relation(references: [id], fields: [batchId])
  instituteId                 String                       @db.ObjectId
  insitution                  Institution                  @relation(references: [id], fields: [instituteId])
  courseProgresses            CourseProgress[]
  courseAssignemntSubmissions CourseAssignemntSubmission[]
  problemSubmissions          ProblemSubmission[]
  assessmentSubmissions       AssessmentSubmission[]
  createdAt                   DateTime                     @default(now())
  updatedAt                   DateTime                     @updatedAt
  problemTemplates            ProblemTemplate[]
}

model Course {
  id                String             @id @default(auto()) @map("_id") @db.ObjectId
  name              String             @unique
  description       String
  level             COURSE_LEVEL       @default(BASIC)
  duration          String?
  thumbnail         String?
  instructorName    String
  certificate       String?
  isPublished       COURSE_STATUS      @default(NOT_PUBLISHED)
  createdBy         String             @db.ObjectId
  creator           User               @relation(fields: [createdBy], references: [id])
  courseSections    CourseSections[]
  courseEnrollments CourseEnrollment[]
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
}

model CourseSections {
  id                     String                  @id @default(auto()) @map("_id") @db.ObjectId
  name                   String
  creatorId              String                  @db.ObjectId
  creator                User                    @relation(references: [id], fields: [creatorId])
  courseId               String                  @db.ObjectId
  course                 Course                  @relation(references: [id], fields: [courseId])
  courseLearningContents CourseLearningContent[]
  courseAssignemnts      CourseAssignemnt[]
  problems               Problem[]
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt
}

model CourseLearningContent {
  id               String           @id @default(auto()) @map("_id") @db.ObjectId
  name             String
  description      String?
  creatorId        String           @db.ObjectId
  creator          User             @relation(references: [id], fields: [creatorId])
  sectionId        String           @db.ObjectId
  section          CourseSections   @relation(references: [id], fields: [sectionId], onDelete: Cascade)
  videoUrl         String           @default("")
  transcript       String?          @default("")
  file             String?          @default("")
  courseProgresses CourseProgress[]
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
}

model CourseProgress {
  id        String                @id @default(auto()) @map("_id") @db.ObjectId
  studentId String                @db.ObjectId
  student   Student               @relation(references: [id], fields: [studentId])
  contentId String                @db.ObjectId
  content   CourseLearningContent @relation(references: [id], fields: [contentId])
  createdAt DateTime              @default(now())
  updatedAt DateTime              @updatedAt

  @@unique([studentId, contentId])
}

model CourseAssignemnt {
  id                        String                     @id @default(auto()) @map("_id") @db.ObjectId
  name                      String
  description               String
  instruction               String
  marksPerQuestion          Int
  sectionId                 String                     @db.ObjectId
  section                   CourseSections             @relation(fields: [sectionId], references: [id])
  courseAssignemntQuestions CourseAssignemntQuestion[]
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime                   @updatedAt
}

model CourseAssignemntQuestion {
  id                          String                       @id @default(auto()) @map("_id") @db.ObjectId
  question                    String
  options                     String[]
  correctAnswer               String[]
  assignmentId                String                       @db.ObjectId
  assignment                  CourseAssignemnt             @relation(fields: [assignmentId], references: [id],onDelete: Cascade)
  type                        ASSIGNMENT_TYPE              @default(SCQ)
  courseAssignemntSubmissions CourseAssignemntSubmission[]
  createdAt                   DateTime                     @default(now())
  updatedAt                   DateTime                     @updatedAt
}

model CourseAssignemntSubmission {
  id            String                   @id @default(auto()) @map("_id") @db.ObjectId
  questionId    String                   @db.ObjectId
  question      CourseAssignemntQuestion @relation(references: [id], fields: [questionId],onDelete: Cascade)
  studentId     String                   @db.ObjectId
  student       Student                  @relation(fields: [studentId], references: [id])
  answer        String[]
  marksObtained Int?
  isCorrect     Boolean?
  submittedAt   DateTime                 @default(now())
  createdAt     DateTime                 @default(now())
  updatedAt     DateTime                 @updatedAt
}

model CourseEnrollment {
  id            String       @id @default(auto()) @map("_id") @db.ObjectId
  courseId      String       @db.ObjectId
  course        Course       @relation(fields: [courseId], references: [id])
  batchId       String       @db.ObjectId
  batch         Batch        @relation(fields: [batchId], references: [id])
  enrolledAt    DateTime     @default(now())
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  institution   Institution? @relation(fields: [institutionId], references: [id])
  institutionId String?      @db.ObjectId

  @@unique([courseId, batchId])
}

model Problem {
  id          String        @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String
  hints       String[]
  difficulty  PROBLEM_LEVEL @default(EASY)
  createdBy   String        @db.ObjectId
  creator     User          @relation(fields: [createdBy], references: [id])

  sectionId           String?              @db.ObjectId
  section             CourseSections?      @relation(fields: [sectionId], references: [id])
  published           LISTING_STATUS       @default(NOT_LISTED)
  testCases           ProblemTestCase[]
  submissions         ProblemSubmission[]
  solution            ProblemSolution?
  assessmentQuestions AssessmentQuestion[]
  problemTemplates    ProblemTemplate[]
  problemTopics       ProblemTopic[]
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
}

model ProblemTopic {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  problemId String   @db.ObjectId
  problem   Problem  @relation(references: [id], fields: [problemId])
  tagName   String[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ProblemTemplate {
  id           String    @id @default(auto()) @map("_id") @db.ObjectId
  problemId    String    @db.ObjectId
  problem      Problem   @relation(references: [id], fields: [problemId])
  functionBody String
  defaultCode  String
  language     LANGUAGES
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  students     Student?  @relation(fields: [studentsId], references: [id])
  studentsId   String?   @db.ObjectId
}

model ProblemTestCase {
  id        String        @id @default(auto()) @map("_id") @db.ObjectId
  testType  TESTCASE_TYPE
  input     String
  output    String
  problemId String        @db.ObjectId
  problem   Problem       @relation(fields: [problemId], references: [id])
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
}

model ProblemSolution {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  solution      String
  videoSolution String?
  problemId     String   @unique @db.ObjectId
  problem       Problem  @relation(fields: [problemId], references: [id])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model ProblemSubmission {
  id      String         @id @default(auto()) @map("_id") @db.ObjectId
  code    String
  runtime String?
  memory  String?
  status  PROBLEM_STATUS

  studentId String  @db.ObjectId
  student   Student @relation(fields: [studentId], references: [id])

  problemId String  @db.ObjectId
  problem   Problem @relation(fields: [problemId], references: [id])

  submittedAt DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Assessment {
  id                         String            @id @default(auto()) @map("_id") @db.ObjectId
  name                       String
  description                String
  instruction                String
  startTime                  DateTime
  endTime                    DateTime
  individualSectionTimeLimit Int?
  status                     ASSESSMENT_STATUS @default(UPCOMING)

  creatorId   String @db.ObjectId
  creatorType String @default("ADMIN")

  batchId String @db.ObjectId
  batch   Batch  @relation(fields: [batchId], references: [id])

  sections    AssessmentSection[]
  submissions AssessmentSubmission[]
  createdAt   DateTime               @default(now())
  updatedAt   DateTime               @updatedAt
  teacher     Teacher?               @relation(fields: [teacherId], references: [id])
  teacherId   String?                @db.ObjectId
}

model AssessmentSection {
  id               String          @id @default(auto()) @map("_id") @db.ObjectId
  name             String
  marksPerQuestion Int
  assessmentType   ASSESSMENT_TYPE

  assessmentId String     @db.ObjectId
  assessment   Assessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)

  questions AssessmentQuestion[]
  createdAt DateTime             @default(now())
  updatedAt DateTime             @updatedAt
}

model AssessmentQuestion {
  id            String            @id @default(auto()) @map("_id") @db.ObjectId
  question      String?
  options       String[]
  correctOption Int?
  sectionId     String            @db.ObjectId
  section       AssessmentSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)

  problemId String?  @db.ObjectId
  problem   Problem? @relation(fields: [problemId], references: [id])

  maxMarks                      Int
  assessmentQuestionSubmissions AssessmentQuestionSubmission[]
  createdAt                     DateTime                       @default(now())
  updatedAt                     DateTime                       @updatedAt
}

model AssessmentSubmission {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  assessmentId String     @db.ObjectId
  assessment   Assessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)

  studentId                     String                         @db.ObjectId
  student                       Student                        @relation(fields: [studentId], references: [id])
  studentIp                     String
  proctoringStatus              PROCTOR                        @default(NOT_CHEATED)
  startedAt                     DateTime                       @default(now())
  submittedAt                   DateTime?
  totalMarks                    Int?
  isSubmitted                   Boolean                        @default(false)
  assessmentQuestionSubmissions AssessmentQuestionSubmission[]
  createdAt                     DateTime                       @default(now())
  updatedAt                     DateTime                       @updatedAt

  @@unique([assessmentId, studentId])
}

model AssessmentQuestionSubmission {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  questionId String             @db.ObjectId
  question   AssessmentQuestion @relation(fields: [questionId], references: [id], onDelete: Cascade)

  answer                 String?
  marksObtained          Int?
  createdAt              DateTime              @default(now())
  updatedAt              DateTime              @updatedAt
  assessmentSubmission   AssessmentSubmission? @relation(fields: [assessmentSubmissionId], references: [id])
  assessmentSubmissionId String?               @db.ObjectId
}
